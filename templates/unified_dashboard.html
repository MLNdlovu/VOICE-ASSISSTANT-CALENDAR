<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Voice Assistant Calendar - One page for everything">
    <title>Voice Assistant Calendar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='voice-animations.css') }}">
    <style>
        /* Unified dashboard combining AI + Booking */
        .unified-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: calc(100vh - 100px);
        }

        .dashboard-panel {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* AI Chat Panel */
        .chat-history {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .chat-message {
            padding: 12px;
            border-radius: 8px;
            max-width: 90%;
            word-wrap: break-word;
        }

        .chat-message.user {
            background: rgba(66, 165, 245, 0.15);
            border-left: 3px solid #42a5f5;
            align-self: flex-end;
            color: #b3e5fc;
        }

        .chat-message.ai {
            background: rgba(76, 175, 80, 0.15);
            border-left: 3px solid #4caf50;
            align-self: flex-start;
            color: #81c784;
        }

        .chat-input-area {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .chat-input-area textarea {
            flex: 1;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: #e0e0e0;
            padding: 10px;
            resize: none;
            height: 50px;
        }

        .chat-input-area button {
            background: linear-gradient(135deg, #42a5f5, #1e88e5);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            padding: 10px 16px;
            font-weight: 600;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-action-btn {
            background: rgba(66, 165, 245, 0.1);
            border: 1px solid rgba(66, 165, 245, 0.3);
            border-radius: 6px;
            color: #42a5f5;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action-btn:hover {
            background: rgba(66, 165, 245, 0.2);
            border-color: #42a5f5;
        }

        /* Booking Panel */
        .booking-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .booking-input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .booking-input-group label {
            font-size: 12px;
            color: #b0b0c0;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .booking-input-group input,
        .booking-input-group select {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: #e0e0e0;
            padding: 10px;
            font-size: 13px;
        }

        .booking-input-group input:focus,
        .booking-input-group select:focus {
            outline: none;
            border-color: #42a5f5;
            background: rgba(66, 165, 245, 0.1);
        }

        .booking-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .booking-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 8px;
        }

        .btn-book {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            border: none;
            border-radius: 6px;
            color: white;
            padding: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-book:hover {
            background: linear-gradient(135deg, #66bb6a, #4caf50);
            transform: translateY(-2px);
        }

        .btn-voice {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 6px;
            color: #ffc107;
            padding: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-voice:hover {
            background: rgba(255, 193, 7, 0.2);
        }

        .btn-voice.recording {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .booking-ai-suggest {
            background: rgba(66, 165, 245, 0.08);
            border-left: 3px solid #42a5f5;
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            color: #90caf9;
            margin-top: 12px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .unified-dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Voice recording indicator */
        .recording-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            color: #f44336;
            font-size: 12px;
            margin-top: 8px;
        }

        .recording-indicator.active {
            display: flex;
        }

        .recording-dot {
            width: 8px;
            height: 8px;
            background: #f44336;
            border-radius: 50%;
            animation: pulse-dot 0.5s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-content">
                <h1>üóìÔ∏è Voice Calendar</h1>
                <div class="header-right">
                    <span id="user-display" class="user-email" aria-label="Current user">
                        {{ user_name }} {{ user_surname }}
                    </span>
                    <span id="trigger-display" style="color: #ffc107; font-weight: 600; margin-left: 16px;">
                        Trigger: {{ user_trigger }}
                    </span>
                    <button id="theme-toggle-btn" class="btn btn-icon" title="Toggle theme">üåó</button>
                    <a href="/logout" class="btn btn-logout">Sign Out</a>
                </div>
            </div>
        </header>

        <!-- Unified Dashboard -->
        <main class="unified-dashboard">
            <!-- Left Panel: AI Chat -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    üí¨ AI Assistant
                </div>
                <div class="panel-content">
                    <div class="chat-history" id="chat-history">
                        <div class="chat-message ai">
                            üëã Hi {{ user_name }}! I can help you:
                            <br>‚Ä¢ Ask about your schedule
                            <br>‚Ä¢ Suggest meeting times
                            <br>‚Ä¢ Draft emails
                            <br>‚Ä¢ Summarize your day
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="quickAiAction('today')">üìÖ Today's Meetings</button>
                        <button class="quick-action-btn" onclick="quickAiAction('week')">üìä Week Summary</button>
                        <button class="quick-action-btn" onclick="quickAiAction('suggest')">üí° Suggest Times</button>
                        <button class="quick-action-btn" onclick="quickAiAction('email')">‚úâÔ∏è Draft Email</button>
                    </div>

                    <div class="chat-input-area">
                        <textarea id="chat-input" placeholder="Ask me anything about your calendar..." rows="2"></textarea>
                        <button onclick="sendChatMessage()" title="Send message (Ctrl+Enter)">üì§</button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Booking + Reminders -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    üìÖ Book or Remind
                </div>
                <div class="panel-content">
                    <form class="booking-form" onsubmit="submitBooking(event)">
                        <!-- Event Type -->
                        <div class="booking-input-group">
                            <label for="event-type">What do you want to do? *</label>
                            <select id="event-type" onchange="updateBookingForm()" required>
                                <option value="book">üìÖ Book a Meeting</option>
                                <option value="remind">üîî Set a Reminder</option>
                            </select>
                        </div>

                        <!-- Title/Description -->
                        <div class="booking-input-group">
                            <label for="event-title">Title *</label>
                            <input type="text" id="event-title" placeholder="e.g., Team Meeting, Doctor Appointment" required>
                        </div>

                        <!-- Date and Time -->
                        <div class="booking-row">
                            <div class="booking-input-group">
                                <label for="event-date">Date *</label>
                                <input type="date" id="event-date" required>
                            </div>
                            <div class="booking-input-group">
                                <label for="event-time">Time *</label>
                                <input type="time" id="event-time" required>
                            </div>
                        </div>

                        <!-- Duration (for meetings) -->
                        <div class="booking-input-group" id="duration-group">
                            <label for="event-duration">Duration</label>
                            <select id="event-duration">
                                <option value="30">30 minutes</option>
                                <option value="60" selected>1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                                <option value="180">3 hours</option>
                            </select>
                        </div>

                        <!-- Attendees (for meetings) -->
                        <div class="booking-input-group" id="attendees-group">
                            <label for="event-attendees">Attendees (comma-separated)</label>
                            <input type="text" id="event-attendees" placeholder="e.g., john@example.com, sarah@example.com">
                        </div>

                        <!-- Buttons -->
                        <div class="booking-buttons">
                            <button type="submit" class="btn-book" id="submit-btn">Book Meeting</button>
                            <button type="button" class="btn-voice" id="voice-btn" onclick="startVoiceBooking()">üé§ Voice</button>
                        </div>

                        <div class="recording-indicator" id="recording-indicator">
                            <div class="recording-dot"></div>
                            <span>Listening...</span>
                        </div>

                        <div class="booking-ai-suggest" id="ai-suggest" style="display: none;"></div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize today's date
        document.getElementById('event-date').valueAsDate = new Date();

        // Quick AI actions
        async function quickAiAction(action) {
            const messages = {
                'today': "What meetings do I have today?",
                'week': "Summarize my schedule for this week",
                'suggest': "Suggest the best times for a 1-hour meeting next week",
                'email': "Draft a professional follow-up email for my last meeting"
            };
            
            document.getElementById('chat-input').value = messages[action];
            await sendChatMessage();
        }

        // Send chat message
        async function sendChatMessage() {
            const message = document.getElementById('chat-input').value.trim();
            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            document.getElementById('chat-input').value = '';

            // Show loading
            addChatMessage('ai', '‚è≥ Thinking...');

            try {
                const res = await fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                const data = await res.json();

                // Remove loading message
                const history = document.getElementById('chat-history');
                history.lastChild.remove();

                if (res.ok && data.success) {
                    addChatMessage('ai', data.response);
                } else {
                    addChatMessage('ai', '‚ùå ' + (data.error || 'Failed to get response'));
                }
            } catch (err) {
                const history = document.getElementById('chat-history');
                history.lastChild.remove();
                addChatMessage('ai', '‚ùå Error: ' + err.message);
            }
        }

        function addChatMessage(role, text) {
            const history = document.getElementById('chat-history');
            const msg = document.createElement('div');
            msg.className = `chat-message ${role}`;
            msg.textContent = text;
            history.appendChild(msg);
            history.scrollTop = history.scrollHeight;
        }

        // Update booking form based on type
        function updateBookingForm() {
            const type = document.getElementById('event-type').value;
            const isBook = type === 'book';
            document.getElementById('duration-group').style.display = isBook ? 'block' : 'none';
            document.getElementById('attendees-group').style.display = isBook ? 'block' : 'none';
            document.getElementById('submit-btn').textContent = isBook ? 'üìÖ Book Meeting' : 'üîî Set Reminder';
        }

        // Submit booking
        async function submitBooking(e) {
            e.preventDefault();
            
            const type = document.getElementById('event-type').value;
            const title = document.getElementById('event-title').value;
            const date = document.getElementById('event-date').value;
            const time = document.getElementById('event-time').value;
            const duration = parseInt(document.getElementById('event-duration').value);
            const attendees = document.getElementById('event-attendees').value;

            const payload = {
                summary: title,
                date, time,
                duration,
                attendees,
                type
            };

            try {
                const endpoint = type === 'book' ? '/api/book' : '/api/set-reminder';
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();

                if (res.ok && data.success) {
                    addChatMessage('ai', `‚úÖ ${type === 'book' ? 'Meeting booked' : 'Reminder set'}! ${title} on ${date} at ${time}`);
                    document.getElementById('event-title').value = '';
                } else {
                    addChatMessage('ai', '‚ùå ' + (data.error || 'Failed to book'));
                }
            } catch (err) {
                addChatMessage('ai', '‚ùå Error: ' + err.message);
            }
        }

        // Voice booking
        function startVoiceBooking() {
            const btn = document.getElementById('voice-btn');
            const indicator = document.getElementById('recording-indicator');
            
            btn.classList.toggle('recording');
            indicator.classList.toggle('active');

            if (btn.classList.contains('recording')) {
                btn.textContent = '‚èπÔ∏è Stop';
                // Start voice recording (would integrate with real voice API)
            } else {
                btn.textContent = 'üé§ Voice';
                // Stop and process
            }
        }

        // Keyboard shortcut for chat
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                sendChatMessage();
            }
        });
    </script>
</body>
</html>

    <script src="{{ url_for('static', filename='voice-assistant.js') }}"></script>
